/*********************************************************
  نام فایل: 01-System-Architecture.md
  مسیر: docs/smart-docs/02-Architecture/01-System-Architecture.md
*********************************************************/
/* به نام خدای نزدیک */

# معماری سیستم (System Architecture)

این مستند معماری کلی سیستم دستیار هوشمند توسعه را توضیح می‌دهد.

## 1. نمای کلی

دستیار هوشمند توسعه یک برنامه دسکتاپ مبتنی بر الکترون (Electron) است که از فناوری‌های وب برای رابط کاربری و Node.js برای منطق برنامه استفاده می‌کند. معماری کلی سیستم شامل موارد زیر است:

```
+-------------------+     +-------------------+     +-------------------+
|                   |     |                   |     |                   |
|   Renderer        | <-> |   Main Process    | <-> |   Database        |
|   (React UI)      |     |   (Node.js)       |     |   (SQLite)        |
|                   |     |                   |     |                   |
+-------------------+     +-------------------+     +-------------------+
```

## 2. لایه‌های اصلی

### 2.1. لایه رابط کاربری (UI)
- **تکنولوژی**: React.js، TypeScript، SCSS
- **وظایف**: نمایش اطلاعات به کاربر، دریافت ورودی‌های کاربر
- **مسیر اصلی**: `src/ui/`
- **فایل‌های کلیدی**: 
  - `App.tsx`: کامپوننت اصلی برنامه
  - `components/`: کامپوننت‌های مختلف UI
  - `styles/`: فایل‌های استایل

### 2.2. لایه منطق برنامه (Main Process)
- **تکنولوژی**: Node.js، TypeScript
- **وظایف**: مدیریت برنامه، ارتباط با پایگاه داده، پردازش داده‌ها
- **مسیر اصلی**: `src/`
- **فایل‌های کلیدی**:
  - `main.ts`: نقطه ورود اصلی برنامه
  - `preload.ts`: اسکریپت پیش‌بارگذاری برای ارتباط بین لایه‌ها

### 2.3. لایه سرویس‌ها (Services)
- **تکنولوژی**: TypeScript
- **وظایف**: ارائه سرویس‌های مختلف به برنامه
- **مسیر اصلی**: `src/core/services/`
- **سرویس‌های اصلی**:
  - `databaseService.ts`: مدیریت ارتباط با پایگاه داده
  - `userService.ts`: مدیریت کاربران
  - `taskService.ts`: مدیریت تسک‌ها

### 2.4. لایه پایگاه داده (Database)
- **تکنولوژی**: SQLite
- **وظایف**: ذخیره‌سازی و بازیابی داده‌ها
- **مسیر اصلی**: `src/core/db/`
- **فایل‌های کلیدی**:
  - `setup.ts`: راه‌اندازی و تنظیم پایگاه داده

## 3. ارتباط بین لایه‌ها

### 3.1. ارتباط بین Renderer و Main Process
ارتباط بین لایه رابط کاربری (Renderer) و فرآیند اصلی (Main Process) از طریق مکانیزم IPC (Inter-Process Communication) الکترون برقرار می‌شود:

1. **پیام‌رسانی از Renderer به Main**: با استفاده از `ipcRenderer.invoke()`
2. **پیام‌رسانی از Main به Renderer**: با استفاده از `mainWindow.webContents.send()`
3. **تعریف API‌ها**: در فایل `preload.ts` با استفاده از `contextBridge.exposeInMainWorld()`

### 3.2. ارتباط با پایگاه داده
فرآیند اصلی (Main Process) از طریق سرویس‌های مختلف با پایگاه داده ارتباط برقرار می‌کند:

```
+---------------+     +---------------+     +---------------+
|               |     |               |     |               |
| UserService   | --> | DatabaseService| --> | SQLite Database|
|               |     |               |     |               |
+---------------+     +---------------+     +---------------+
```

## 4. مدیریت حالت (State Management)

مدیریت حالت در این برنامه در دو سطح انجام می‌شود:

1. **مدیریت حالت در لایه UI**: با استفاده از React Hooks و Context API
2. **مدیریت حالت در لایه Main Process**: با استفاده از سرویس‌ها و پایگاه داده

## 5. امنیت و دسترسی‌ها

- **احراز هویت**: از طریق رمزنگاری با bcrypt
- **کنترل دسترسی**: بر اساس نقش‌های تعریف‌شده (role-based access)
- **امنیت داده**: استفاده از prepared statements برای جلوگیری از SQL Injection

## 6. استراتژی توسعه

- **توسعه افزایشی**: اضافه کردن ویژگی‌ها به صورت تدریجی
- **الگوهای طراحی**: استفاده از الگوهای Repository، Service و Singleton
- **تست‌پذیری**: طراحی کدها به گونه‌ای که قابلیت تست داشته باشند

---

## مراجع و منابع
- [Electron Documentation](https://www.electronjs.org/docs)
- [React Documentation](https://reactjs.org/docs)
- [TypeScript Documentation](https://www.typescriptlang.org/docs)
- [SQLite Documentation](https://www.sqlite.org/docs.html) 